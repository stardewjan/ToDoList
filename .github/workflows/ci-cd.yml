name: CI/CD Pipeline

on:
  push:
    branches:
      - main

jobs:
  build-and-test:
    runs-on: ubuntu-latest

    steps:
    # 1. Проверка исходного кода
    - name: Checkout code
      uses: actions/checkout@v3

    # 2. Установка Docker CLI
    - name: Setup Docker
      uses: docker/setup-buildx-action@v2

    # 3. Сборка Docker-образа
    - name: Build Docker image
      run: docker build -t todo-list-app:latest .

    # 4. Запуск контейнера для тестов
    - name: Run tests in Docker
      run: |
        docker run --rm todo-list-app:latest dotnet test ./ToDoList.Tests/ToDoList.Tests.csproj --logger "console;verbosity=detailed"
